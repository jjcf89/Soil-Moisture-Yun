<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Soil-moisture-yun by jjcf89</title>
	
    <!-- EXTERNAL LIBS-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dygraph/1.1.1/dygraph-combined-dev.js"></script>
    <!-- http://dygraphs.com/tutorial.html -->
    <script src="javascripts/spin.min.js"></script>
    <script src="javascripts/jquery.spin.js"></script>

    <!-- EXAMPLE SCRIPT -->
    <script>
	google.charts.load('current', {
	  packages: ['corechart']
	});
	google.charts.setOnLoadCallback(draw);

	function draw() {
	  var public_key = 'xRpV3GA0jVHMnoOnor2K';
	  
          $.fn.spin.presets.flower = {
            lines:   9
          , length: 20
          , width:  20
          , radius:  20
          };
	  
	  $('#spinner').spin('flower');

	  // JSONP request
	  var jsonData = $.ajax({
		url: 'https://data.sparkfun.com/output/' + public_key + '.json',
		data: {
		  //page: 1
		},
		//dataType: 'jsonp',
		xhr: function() {
			console.log("New xhr");
			var xhr = new window.XMLHttpRequest();
			//Download progress
			xhr.addEventListener("progress", function(evt) {
				if (evt.lengthComputable) {
					var percentComplete = evt.loaded / evt.total;
					//Do something with download progress
					console.log(percentComplete);
				}
				else
				{
					var size = Math.floor(evt.loaded / 1000);
					$("#progress").text(size + "kB loaded");
				}
			}, false);
			return xhr;
		},
	  }).done(function(results) {

		var data = new google.visualization.DataTable();

		data.addColumn('datetime', 'Time');
		data.addColumn('number', 'Temp');
		data.addColumn('number', 'Humidity');
		data.addColumn('number', 'Moisture1');
		data.addColumn('number', 'Moisture2');

		results.reverse();
		$.each(results, function(i, row) {
		  data.addRow([
			(new Date(row.timestamp)),
			parseFloat(row.tempf),
			parseFloat(row.humidity),
			parseFloat(row.moisture1),
			parseFloat(row.moisture2)
		  ]);
		});
		
		var view = new google.visualization.DataView(data);
		view.setColumns([0, 1, 2]);

		g = new Dygraph(document.getElementById("graph"),
		  // For possible data formats, see http://dygraphs.com/data.html
		  // The x-values could also be dates, e.g. "2012/03/15"
		  view, {
			// options go here. See http://dygraphs.com/options.html
			legend: 'always',
			animatedZooms: true,
			title: 'Humidity/Temp',
			rollPeriod: 50,
			showRoller: true,
		  });
		
		//var view = new google.visualization.DataView(data);
		view.setColumns([0, 3, 4]);
		  
		g = new Dygraph(document.getElementById("moisturegraph"),
		  // For possible data formats, see http://dygraphs.com/data.html
		  // The x-values could also be dates, e.g. "2012/03/15"
		  view, {
			// options go here. See http://dygraphs.com/options.html
			legend: 'always',
			animatedZooms: true,
			title: 'Moisture',
			rollPeriod: 10,
			showRoller: true,
		  });
		  
		  $('#spinner').spin(false);
	  });
	}
	</script>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Soil-moisture-yun</h1>
          <h2>Attempt at logging potted plant moisture</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/jjcf89/Soil-Moisture-Yun/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/jjcf89/Soil-Moisture-Yun/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/jjcf89/Soil-Moisture-Yun" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
        	
		<div id="progress"></div>
		<div id="spinner"></div>
		<div id="graph"></div>
		<div id="moisturegraph"></div>
        </section>

        <footer>
          Soil-moisture-yun is maintained by <a href="https://github.com/jjcf89">jjcf89</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
